@if exist "%HOMEDRIVE%%HOMEPATH%\AppData\Local\Morlock" goto CREATED_HOME
@echo --------------------------------------------------------------------------------
@echo Installing Morlock
@echo --------------------------------------------------------------------------------
@echo Creating home folder: %HOMEDRIVE%%HOMEPATH%\AppData\Local\Morlock
@mkdir "%HOMEDRIVE%%HOMEPATH%\AppData\Local\Morlock"
:CREATED_HOME

@if exist "%HOMEDRIVE%%HOMEPATH%\AppData\Local\Morlock\build\brombres\morlock" goto CREATED_BUILD
@mkdir "%HOMEDRIVE%%HOMEPATH%\AppData\Local\Morlock\build\brombres\morlock"
:CREATED_BUILD

@echo Downloading Morlock bootstrap source...
@curl -H "Cache-Control: no-cache" -fsSL https://raw.githubusercontent.com/brombres/Morlock/main/Source/Bootstrap/Morlock.h -o "%HOMEDRIVE%%HOMEPATH%\AppData\Local\Morlock\build\brombres\morlock\Morlock.h"
@if errorlevel 1 goto ERROR_DOWNLOADING
@curl -H "Cache-Control: no-cache" -fsSL https://raw.githubusercontent.com/brombres/Morlock/main/Source/Bootstrap/Morlock.c -o "%HOMEDRIVE%%HOMEPATH%\AppData\Local\Morlock\build\brombres\morlock\Morlock.c"
@if errorlevel 1 goto ERROR_DOWNLOADING

@echo Compiling Morlock bootstrap...
@cl /nologo "%HOMEDRIVE%%HOMEPATH%\AppData\Local\Morlock\build\brombres\morlock\Morlock.c" /Fo"%HOMEDRIVE%%HOMEPATH%\AppData\Local\Morlock\build\brombres\morlock\morlock-v2.obj" /Fe"%HOMEDRIVE%%HOMEPATH%\AppData\Local\Morlock\build\brombres\morlock\morlock-v2.exe"
@if errorlevel 1 goto ERROR_COMPILING

echo Bootstrapping Morlock...
"%HOMEDRIVE%%HOMEPATH%\AppData\Local\Morlock\build\brombres\morlock\morlock-v2.exe" bootstrap --installer="%0"
@goto EXIT

:ERROR_DOWNLOADING
@echo Error downloading the following files using 'curl':
@echo   https://raw.githubusercontent.com/brombres/Morlock/main/Source/Bootstrap/Morlock.h
@echo   https://raw.githubusercontent.com/brombres/Morlock/main/Source/Bootstrap/Morlock.c
@echo:
@echo Check the internet connection.
@goto EXIT

:ERROR_COMPILING
@echo Error compiling the Morlock bootstrap. Check the following:
@echo   1. Ensure that MS Visual Studio 2019 (or better) with C/C++ support is installed.
@echo   2. Ensure that this command prompt is a VS "Developer Command Prompt".
@echo   3. Ensure that the MSVC command-line C/C++ compiler is installed by running 'cl'.
@goto EXIT

:EXIT
